<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>库洛米</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        kuromi: {
                            purple: '#9370db',
                            pink: '#ff80b0',
                            black: '#2d2d2d'
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .popup-shadow {
                box-shadow: 0 3px 15px rgba(0, 0, 0, 0.2);
            }
            .heart-popup {
                transition: all 0.3s ease-out;
                transform-origin: center;
                opacity: 0;
                transform: scale(0.8);
            }
            .heart-popup.show {
                opacity: 1;
                transform: scale(1);
            }
            .bg-pattern {
                background-image: radial-gradient(rgba(147, 112, 219, 0.1) 1px, transparent 1px);
                background-size: 20px 20px;
            }
            .floating-heart {
                position: absolute;
                pointer-events: none;
                opacity: 0;
                transition: all 0.5s ease;
                animation: float 3s infinite ease-in-out;
            }
            @keyframes float {
                0%, 100% { transform: translateY(0) scale(1); }
                50% { transform: translateY(-10px) scale(1.1); }
            }
            /* 图片自适应样式：保持比例，不超出容器 */
            .adapt-img {
                width: 100%;
                height: 100%;
                object-fit: contain; /* 保持比例，完整显示图片 */
                padding: 4px;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50 bg-pattern overflow-hidden">
    <div id="app" class="relative w-screen h-screen">
        <div id="background-hearts" class="absolute top-0 left-0 w-full h-full"></div>
    </div>

    <script>
        // 根据屏幕宽度动态计算配置参数（核心：响应式适配）
        function getResponsiveConfig() {
            const screenWidth = window.innerWidth;
            let popupSize, desiredPoints, scaleFactor, popupInterval;

            // 手机屏幕（小于768px）
            if (screenWidth < 768) {
                popupSize = Math.min(screenWidth * 0.3, 140); // 弹窗大小为屏幕宽度的30%（最大140px）
                desiredPoints = 60; // 减少弹窗数量，避免拥挤
                scaleFactor = 65; // 心形缩放因子（值越大，心形越小）
                popupInterval = 150; // 增加间隔，避免加载拥挤
            } 
            // 平板/桌面（大于等于768px）
            else {
                popupSize = 160; // 固定尺寸
                desiredPoints = 100;
                scaleFactor = 50;
                popupInterval = 100;
            }

            return {
                desiredPoints: desiredPoints,
                popupWidth: popupSize,
                popupHeight: popupSize, // 保持正方形
                popupDuration: 30000,
                popupInterval: popupInterval,
                bgHeartsCount: screenWidth < 768 ? 15 : 30, // 手机减少背景爱心
                bgHeartMinSize: screenWidth < 768 ? 8 : 12,
                bgHeartMaxSize: screenWidth < 768 ? 25 : 40,
                bgHeartMinDuration: 3000,
                bgHeartMaxDuration: 8000,
                scaleFactor: scaleFactor // 用于心形缩放的参数
            };
        }

        // 库洛米图片URL列表（已修复逗号分隔）
        const kuromiImages = [
            'https://github.com/Fiallsnu/Kuromi/blob/main/photo/库洛米.jpg?raw=true',
            'https://github.com/Fiallsnu/Kuromi/blob/main/photo/库洛米1.jpg?raw=true',
            'https://github.com/Fiallsnu/Kuromi/blob/main/photo/库洛米2.jpg?raw=true',
            'https://github.com/Fiallsnu/Kuromi/blob/main/photo/库洛米3.jpg?raw=true',
            'https://github.com/Fiallsnu/Kuromi/blob/main/photo/库洛米4.jpg?raw=true',
        ];

        // 背景爱心颜色
        const heartColors = [
            'text-purple-300', 'text-purple-400', 'text-purple-500',
            'text-pink-300', 'text-pink-400', 'text-kuromi-purple'
        ];

        // 获取屏幕尺寸
        let screenWidth = window.innerWidth;
        let screenHeight = window.innerHeight;
        let config = getResponsiveConfig(); // 初始化响应式配置

        // 生成心形点坐标（根据屏幕尺寸动态调整）
        function generateHeartPoints(numPoints, screenW, screenH, windowW, windowH, scaleFactor) {
            const points = [];
            const centerX = screenW / 2;
            const centerY = screenH / 2;
            // 核心：根据屏幕宽度和配置的缩放因子计算心形大小
            const scale = Math.min(screenW / scaleFactor, screenH / scaleFactor);
            
            for (let i = 0; i < numPoints; i++) {
                const t = (i / numPoints) * 2 * Math.PI;
                let x = 16 * Math.pow(Math.sin(t), 3);
                let y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
                y = -y;
                
                x = centerX + x * scale;
                y = centerY + y * scale;
                
                // 确保弹窗不超出屏幕边缘
                x = Math.max(windowW / 2, Math.min(x, screenW - windowW / 2));
                y = Math.max(windowH / 2, Math.min(y, screenH - windowH / 2));
                
                points.push({ x: Math.floor(x), y: Math.floor(y) });
            }
            
            return points;
        }

        // 生成随机背景色
        function getRandomBgColor() {
            const colors = [
                '#fce4ec', '#f3e5f5', '#ede7f6', 
                '#e8eaf6', '#e0f7fa', '#f1f8e9'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // 创建并显示库洛米弹窗（图片自适应）
        function showKuromiPopup(x, y, width, height) {
            const app = document.getElementById('app');
            
            const popup = document.createElement('div');
            popup.className = 'heart-popup absolute rounded-xl popup-shadow cursor-pointer flex items-center justify-center overflow-hidden';
            popup.style.width = `${width}px`;
            popup.style.height = `${height}px`;
            popup.style.left = `${x - width/2}px`;
            popup.style.top = `${y - height/2}px`;
            
            const bgColor = getRandomBgColor();
            popup.style.backgroundColor = bgColor;
            
            // 随机选择图片
            const imgSrc = kuromiImages[Math.floor(Math.random() * kuromiImages.length)];
            const imgElement = document.createElement('img');
            imgElement.src = imgSrc;
            imgElement.alt = '库洛米';
            imgElement.className = 'adapt-img'; // 使用自适应样式
            // 图片加载失败时的降级处理
            imgElement.onerror = () => {
                imgElement.src = 'https://picsum.photos/160/160'; // 备用图
            };
            popup.appendChild(imgElement);
            
            app.appendChild(popup);
            
            // 显示动画
            setTimeout(() => {
                popup.classList.add('show');
            }, 10);
            
            // 自动关闭
            const autoCloseTimer = setTimeout(() => {
                closePopup(popup);
            }, config.popupDuration);
            
            // 点击关闭
            popup.addEventListener('click', () => {
                clearTimeout(autoCloseTimer);
                closePopup(popup);
            });
        }

        // 关闭弹窗
        function closePopup(popup) {
            popup.classList.remove('show');
            popup.classList.add('opacity-0', 'scale-90');
            
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 300);
        }

        // 创建背景爱心（响应式大小）
        function createBackgroundHeart() {
            const container = document.getElementById('background-hearts');
            const heart = document.createElement('i');
            
            const size = Math.floor(Math.random() * (config.bgHeartMaxSize - config.bgHeartMinSize)) + config.bgHeartMinSize;
            const color = heartColors[Math.floor(Math.random() * heartColors.length)];
            const left = Math.floor(Math.random() * 100);
            const top = Math.floor(Math.random() * 100);
            const opacity = 0.2 + Math.random() * 0.5;
            const duration = Math.floor(Math.random() * (config.bgHeartMaxDuration - config.bgHeartMinDuration)) + config.bgHeartMinDuration;
            const delay = Math.random() * 2;
            
            heart.className = `fa fa-heart floating-heart ${color}`;
            heart.style.fontSize = `${size}px`;
            heart.style.left = `${left}%`;
            heart.style.top = `${top}%`;
            heart.style.opacity = '0';
            heart.style.animationDelay = `${delay}s`;
            
            container.appendChild(heart);
            
            setTimeout(() => {
                heart.style.opacity = opacity;
            }, 100);
            
            setTimeout(() => {
                heart.style.opacity = '0';
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                    }
                }, 500);
            }, duration);
        }

        // 管理背景爱心
        function manageBackgroundHearts() {
            setInterval(() => {
                const currentHearts = document.querySelectorAll('#background-hearts .floating-heart').length;
                if (currentHearts < config.bgHeartsCount) {
                    const toAdd = Math.min(3, config.bgHeartsCount - currentHearts);
                    for (let i = 0; i < toAdd; i++) {
                        setTimeout(createBackgroundHeart, Math.random() * 1000);
                    }
                }
            }, 1000);
        }

        // 初始化
        function init() {
            // 清空现有内容（避免重复）
            const app = document.getElementById('app');
            app.querySelectorAll('.heart-popup').forEach(el => el.remove());
            app.querySelectorAll('#background-hearts .floating-heart').forEach(el => el.remove());
            
            // 重新计算响应式配置
            config = getResponsiveConfig();
            screenWidth = window.innerWidth;
            screenHeight = window.innerHeight;
            
            // 初始化背景爱心
            manageBackgroundHearts();
            
            // 生成心形点并显示弹窗
            const points = generateHeartPoints(
                config.desiredPoints,
                screenWidth,
                screenHeight,
                config.popupWidth,
                config.popupHeight,
                config.scaleFactor // 传入缩放因子
            );
            
            points.forEach((point, index) => {
                setTimeout(() => {
                    showKuromiPopup(point.x, point.y, config.popupWidth, config.popupHeight);
                }, index * config.popupInterval);
            });
        }

        // 页面加载时初始化
        window.addEventListener('load', init);

        // 窗口大小改变时重新适配
        window.addEventListener('resize', () => {
            // 避免频繁触发，添加防抖
            clearTimeout(window.resizeTimer);
            window.resizeTimer = setTimeout(init, 300);
        });
    </script>
</body>
</html>
